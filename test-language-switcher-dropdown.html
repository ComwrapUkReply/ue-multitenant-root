<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Switcher Dropdown Test</title>
    <link rel="stylesheet" href="/styles/styles.css">
    <link rel="stylesheet" href="/blocks/language-switcher/language-switcher.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem;
        }
        .test-button:hover {
            background: #005a87;
        }
        .debug-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Language Switcher Dropdown Test</h1>
        
        <div class="test-section">
            <h2>Test 1: Block Implementation</h2>
            <div class="block language-switcher" data-block-name="language-switcher">
                <div>
                    <div>displayStyle</div>
                    <div>dropdown</div>
                </div>
                <div>
                    <div>supportedLocales</div>
                    <div>ch-de,ch-fr,ch-en,de-de,de-en</div>
                </div>
                <div>
                    <div>showCountryFlags</div>
                    <div>true</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Test 2: Header Implementation</h2>
            <div class="nav-tools">
                <p>Language switcher placeholder</p>
            </div>
        </div>

        <div class="test-section">
            <h2>Test Controls</h2>
            <button class="test-button" onclick="testBlockDropdown()">Test Block Dropdown</button>
            <button class="test-button" onclick="testHeaderDropdown()">Test Header Dropdown</button>
            <button class="test-button" onclick="clearDebug()">Clear Debug</button>
        </div>

        <div class="test-section">
            <h2>Debug Output</h2>
            <div id="debug-output" class="debug-output">Click a test button to see debug information...</div>
        </div>
    </div>

    <script type="module">
        import { decorate as decorateLanguageSwitcher } from '/blocks/language-switcher/language-switcher.js';
        import { decorate as decorateHeader } from '/blocks/header/header.js';

        // Initialize the language switcher block
        const languageSwitcherBlock = document.querySelector('.block.language-switcher');
        if (languageSwitcherBlock) {
            decorateLanguageSwitcher(languageSwitcherBlock);
        }

        // Initialize the header
        const headerBlock = document.createElement('div');
        headerBlock.className = 'block header';
        headerBlock.innerHTML = `
            <div class="nav">
                <div class="nav-sections"></div>
                <div class="nav-tools">
                    <p>Language switcher placeholder</p>
                </div>
            </div>
        `;
        document.querySelector('.test-section:nth-child(3)').appendChild(headerBlock);
        decorateHeader(headerBlock);

        // Test functions
        window.testBlockDropdown = () => {
            const block = document.querySelector('.block.language-switcher');
            const button = block?.querySelector('.language-switcher-current');
            const dropdown = block?.querySelector('.language-switcher-dropdown');
            const container = block?.querySelector('.language-switcher-dropdown-container');
            
            const debug = {
                block: !!block,
                button: !!button,
                dropdown: !!dropdown,
                container: !!container,
                hasOpenClass: container?.classList.contains('open'),
                ariaExpanded: button?.getAttribute('aria-expanded'),
                ariaHidden: dropdown?.getAttribute('aria-hidden')
            };
            
            document.getElementById('debug-output').textContent = 
                'Block Dropdown Test:\n' + JSON.stringify(debug, null, 2);
            
            if (button) {
                button.click();
                setTimeout(() => {
                    const afterDebug = {
                        hasOpenClass: container?.classList.contains('open'),
                        ariaExpanded: button?.getAttribute('aria-expanded'),
                        ariaHidden: dropdown?.getAttribute('aria-hidden'),
                        visibility: getComputedStyle(dropdown).visibility,
                        opacity: getComputedStyle(dropdown).opacity
                    };
                    document.getElementById('debug-output').textContent += 
                        '\n\nAfter Click:\n' + JSON.stringify(afterDebug, null, 2);
                }, 100);
            }
        };

        window.testHeaderDropdown = () => {
            const header = document.querySelector('.block.header');
            const button = header?.querySelector('.language-switcher-current');
            const dropdown = header?.querySelector('.language-switcher-dropdown');
            const container = header?.querySelector('.language-switcher-dropdown-container');
            
            const debug = {
                header: !!header,
                button: !!button,
                dropdown: !!dropdown,
                container: !!container,
                hasOpenClass: container?.classList.contains('open'),
                ariaExpanded: button?.getAttribute('aria-expanded'),
                ariaHidden: dropdown?.getAttribute('aria-hidden')
            };
            
            document.getElementById('debug-output').textContent = 
                'Header Dropdown Test:\n' + JSON.stringify(debug, null, 2);
            
            if (button) {
                button.click();
                setTimeout(() => {
                    const afterDebug = {
                        hasOpenClass: container?.classList.contains('open'),
                        ariaExpanded: button?.getAttribute('aria-expanded'),
                        ariaHidden: dropdown?.getAttribute('aria-hidden'),
                        visibility: getComputedStyle(dropdown).visibility,
                        opacity: getComputedStyle(dropdown).opacity
                    };
                    document.getElementById('debug-output').textContent += 
                        '\n\nAfter Click:\n' + JSON.stringify(afterDebug, null, 2);
                }, 100);
            }
        };

        window.clearDebug = () => {
            document.getElementById('debug-output').textContent = 'Debug output cleared.';
        };
    </script>
</body>
</html>
